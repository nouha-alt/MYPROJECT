<?php
session_start();
$userName = $_SESSION['user_name'] ?? "";

$conn = new mysqli("localhost", "root", "", "inscription");
if ($conn->connect_error) die("Connection failed: " . $conn->connect_error);

if(!isset($_SESSION['cart'])){
    $_SESSION['cart'] = [];
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="commerce3.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <style>

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #ffe6f0, #ffccdd);
}

.top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 30px;
    background-color:    #ff6f91;
}

.logo {
    font-size: 28px;
    color: white;
    font-weight: bold;
}

.logo span {
    color: #fff700; 
}
.links a {
    color: white;
    text-decoration: none;
    font-weight: bold;
    padding: 8px 14px;
    border-radius: 20px;
    transition: 0.3s;
}

.links a:hover {
    background-color: #fff700;
    color: #1b1b10;
}
.cart-count{
    position:absolute;
    top:-6px;
    right:-10px;
    background:crimson;
    color:white;
    font-size:12px;
    width:20px;
    height:20px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
}

        
.products-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:25px;
    padding:20px;
}
.product-card{
    background:white;
    padding:15px;
    border-radius:15px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    text-align:center;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
}
.product-card img{
    width:100%;
    border-radius:10px;
}
.product-name{
    margin:12px 0 5px;
    font-size:18px;
    color:#ff4d6d;
}
.price{
    font-size:18px;
    font-weight:bold;
    color:#c91c1c;
}
.add-cart,.remove-cart{
    width:100%;
    padding:10px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    margin-top:10px;
    cursor:pointer;
}
.add-cart{background:#ff4d6d;color:white;}
.add-cart:hover{background:#ff1a3c;}
.remove-cart{background:#bf3985;color:white;}
.remove-cart:hover{background:#ff1a3c;}
.colors{
    display:flex;
    gap:8px;
    margin-top:8px;
    justify-content:center;
}
.colors img{
    width:35px;
    height:35px;
    border-radius:50%;
    object-fit:cover;
    cursor:pointer;
    border:2px solid #ddd;
}
.colors img:hover{border-color:#c91c1c;}
footer{
    background: #ae1a5dff;
    color:#fff;
    text-align:center;
    padding:20px;
    }
    </style>
</head>
<body>
   <header class="top-bar">
    <div class="logo">Snap<span>Store</span></div>
    <nav class="links">
        <a href="commerce1.php">home</a>
<a href="Acheter.php" class="cart-link">Acheter <span class="material-symbols-outlined">shopping_cart</span>
        <span class="cart-count" id="cartCount"><?= count($_SESSION['cart']) ?></span>
        </a>
<a href="compt.php">
        <span class="material-symbols-outlined">account_circle</span>
        <?php if($userName!=""){echo htmlspecialchars($userName);} ?>
    </a>
    </nav>
</header> 
<h1 style="text-align:center; color:#c91c1c; margin-top:20px;">Découvrez notre collection élégante pour femmes</h1>
    <section class="products">
<div class="products-grid">
    
<?php
$result = $conn->query("SELECT * FROM productsfemme");
while($p = $result->fetch_assoc()):
?>
<div class="product-card">
    <img src="<?= htmlspecialchars($p['image']) ?>" class="product-image">
    <h3 class="product-name"><?= htmlspecialchars($p['name']) ?></h3>
    <div class="price"><?= htmlspecialchars($p['price']) ?> DA</div>

    <?php if(!empty($p['colors'])): ?>
        <div class="colors">
            <?php foreach(explode(',', $p['colors']) as $c): ?>
                <img src="<?= htmlspecialchars(trim($c)) ?>" 
                     onclick="this.closest('.product-card').querySelector('.product-image').src=this.src">
            <?php endforeach; ?>
        </div>
    <?php endif; ?>
    <button class="add-cart"
        data-name="<?= htmlspecialchars($p['name']) ?>"
        data-price="<?= htmlspecialchars($p['price']) ?>"
        data-image="<?= htmlspecialchars($p['image']) ?>">
        Ajouter au panier
    </button>

    <button class="remove-cart">Retirer</button>
</div>
<footer>
    <div class="footer-content">
        <p>© 2024 SnapStore. Tous droits réservés.</p>
        <p>Téléphone : 0550 123 456 | Email : <a href="mailto:info@snapstore.com">info@snapstore.com</a></p>
        <p>
            <a href="#">Politique de confidentialité</a> |
            <a href="#">Conditions d'utilisation</a>
        </p>
        <div class="social-media">
            <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
            <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
            <a href="#"><i class="fa-brands fa-instagram"></i></a>
            <a href="#"><i class="fa-brands fa-youtube"></i></a>
            <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
        </div>
    </div>
</footer>
<script>
document.querySelectorAll('.add-cart').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const card = btn.closest('.product-card');
    const product = {
      name: card.querySelector('.product-name').textContent,
      price: card.querySelector('.price').textContent,
      image: card.querySelector('.product-image').src
    };

    fetch('cart_add.php',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(product)
    })
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        document.getElementById('cartCount').textContent = d.count;
      }
    });
  });
});

document.querySelectorAll('.remove-cart').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const card = btn.closest('.product-card');
    const productName = card.querySelector('.product-name').textContent;

    fetch('cart_remove.php',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name:productName})
    })
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        document.getElementById('cartCount').textContent = d.count;
      }
    });
  });
});
</script>

</body>
</html>
